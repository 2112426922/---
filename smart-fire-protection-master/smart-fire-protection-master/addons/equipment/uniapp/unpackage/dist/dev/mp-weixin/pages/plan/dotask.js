(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/plan/dotask"],{157:function(e,t,n){"use strict";(function(e,t){var a=n(4);n(26);a(n(25));var i=a(n(158));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n(1)["default"],n(2)["createPage"])},158:function(e,t,n){"use strict";n.r(t);var a=n(159),i=n(161);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);n(163);var o,u=n(32),c=Object(u["default"])(i["default"],a["render"],a["staticRenderFns"],!1,null,null,null,!1,a["components"],o);c.options.__file="pages/plan/dotask.vue",t["default"]=c.exports},159:function(e,t,n){"use strict";n.r(t);var a=n(160);n.d(t,"render",(function(){return a["render"]})),n.d(t,"staticRenderFns",(function(){return a["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return a["recyclableRender"]})),n.d(t,"components",(function(){return a["components"]}))},160:function(e,t,n){"use strict";var a;n.r(t),n.d(t,"render",(function(){return i})),n.d(t,"staticRenderFns",(function(){return o})),n.d(t,"recyclableRender",(function(){return r})),n.d(t,"components",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=(e._self._c,e.imgList.length),a=e.imgList.length;e.$mp.data=Object.assign({},{$root:{g0:n,g1:a}})},r=!1,o=[];i._withStripped=!0},161:function(e,t,n){"use strict";n.r(t);var a=n(162),i=n.n(a);for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t["default"]=i.a},162:function(e,t,n){"use strict";(function(e){var a=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,r,o,u=a(n(38)),c=!1,s={data:function(){return{fields:[],values:{},workIndex:0,workStatus:["正常","带病运行","停机待修","停机报废"],imgList:[],remark:"",type:""}},onLoad:function(t){if(o=this,!t.id)return o.tui.toast("未知计划任务"),void setTimeout((function(){e.navigateBack()}),1500);i=t.id,r=t.type,o.getInfo(i),o.changeTitle(r)},methods:{changeTitle:function(t){o.type=t,"inspection"==t&&e.setNavigationBarTitle({title:"巡检计划"}),"maintenance"==t&&e.setNavigationBarTitle({title:"保养计划"})},getInfo:function(t){e.showLoading({title:"查询中..."}),o.$api.planTaskField({id:t}).then((function(t){e.hideLoading();var n={},a=t.data;a.forEach((function(e,t){var a={value:e.default,type:e.type,label:e.label,require:e.require};if("radio"==e.type&&(a.index=-1,a.options=JSON.parse(e.options)),"multiple"==e.type){var i=JSON.parse(e.options),r=[];i.forEach((function(e,t){r.push({value:e,checked:!1})})),a.options=r}n[e.name]=a})),o.values=n,o.fields=a})).catch((function(t){e.hideLoading(),o.tui.toast(t.msg)}))},pickerChange:function(e,t){var n=e.detail.value;o.values[t].index=n,o.values[t].value=o.values[t].options[n]},checkboxChange:function(e,t){for(var n=o.values[t].options,a=e.detail.value,i=0,r=n.length;i<r;++i){n[i].checked=!1;for(var u=0,c=a.length;u<c;++u)if(n[i].value==a[u]){n[i].checked=!0;break}}},textareaInput:function(e,t){o.values[t].value=e.detail.value},pickerStatusChange:function(e){o.workIndex=e.detail.value},textareaRemark:function(e){o.remark=e.detail.value},chooseImage:function(){e.chooseImage({count:1,sizeType:["original","compressed"],success:function(t){var n=t.tempFilePaths;e.uploadFile({url:u.default.host+"api/common/upload",filePath:n[0],name:"file",header:{token:e.getStorageSync("equipment_token")},success:function(e){var t=JSON.parse(e.data);o.imgList.push(t.data.fullurl)},fail:function(){o.tui.toast("图片上传失败")}})}})},viewImage:function(t){e.previewImage({urls:o.imgList,current:t.currentTarget.dataset.url})},delImg:function(t){e.showModal({title:"提示",content:"确定要删除这张照片吗？",cancelText:"再看看",confirmText:"确定",cancelColor:"#8799a3",confirmColor:"#333333",success:function(e){e.confirm&&o.imgList.splice(t.currentTarget.dataset.index,1)}})},submit:function(){if(1!=c){c=!0;var t=[],n={images:o.imgList,remark:o.remark,form_data:[]};"inspection"==r&&(n.work_status=o.workStatus[o.workIndex]);var a=Object.values(o.values);try{a.forEach((function(e,n){var a="";switch(e.type){case"radio":a=e.options[e.index],void 0==a&&(a="");break;case"multiple":for(var i=[],r=e.options,o=0,u=r.length;o<u;++o)1==r[o].checked&&i.push(r[o].value);a=i.join("、");break;case"text":case"textarea":case"number":default:a=e.value;break}if(1==e.require&&(""==a||null==a||void 0==a))throw new Error(e.label+" 不能为空");t.push({label:e.label,value:a})}))}catch(u){return c=!1,o.tui.toast(u.message),!1}n.form_data=t,e.showLoading({title:"提交中..."}),o.$api.submitPlanTask({id:i,type:r,content:n}).then((function(t){c=!1,e.hideLoading(),o.tui.toast("提交成功","","success"),setTimeout((function(){var t=o.getOpenerEventChannel();t.emit("doRefresh",{ischange:!0,type:"inspection"}),e.navigateBack()}),1500)})).catch((function(t){c=!1,e.hideLoading(),o.tui.toast(t.msg)}))}}}};t.default=s}).call(this,n(2)["default"])},163:function(e,t,n){"use strict";n.r(t);var a=n(164),i=n.n(a);for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t["default"]=i.a},164:function(e,t,n){}},[[157,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/plan/dotask.js.map